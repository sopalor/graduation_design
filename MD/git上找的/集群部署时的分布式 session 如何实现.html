<html>
<head>
  <title>集群部署时的分布式 session 如何实现</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/600475 (zh-CN, DDL); Windows/10.0.0 (Win64);"/>
  <meta name="content-class" content="yinxiang.markdown"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="469"/>
<h1>集群部署时的分布式 session 如何实现</h1>

<div><span><div style="font-size: 14px; margin: 0; padding: 0; width: 100%;"><h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">集群部署时的分布式 session 如何实现</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">集群部署时的分布式 session 如何实现？</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">面试官心理分析</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">面试官问了你一堆 dubbo 是怎么玩儿的，你会玩儿 dubbo 就可以把单块系统弄成分布式系统，然后分布式之后接踵而来的就是一堆问题，最大的问题就是<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">分布式事务</strong>、<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">接口幂等性</strong>、<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">分布式锁</strong>，还有最后一个就是<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">分布式 session</strong>。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">当然了，分布式系统中的问题何止这么一点，非常之多，复杂度很高，这里只是说一下常见的几个问题，也是面试的时候常问的几个。</p>
<h2 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 34px; border-bottom: 1px solid #dbdbdb; color: #333;">面试题剖析</h2>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">session 是啥？浏览器有个 cookie，在一段时间内这个 cookie 都存在，然后每次发请求过来都带上一个特殊的 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">jsessionid cookie</code>，就根据这个东西，在服务端可以维护一个对应的 session 域，里面可以放点数据。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">一般的话只要你没关掉浏览器，cookie 还在，那么对应的那个 session 就在，但是如果 cookie 没了，session 也就没了。常见于什么购物车之类的东西，还有登录状态保存之类的。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">这个不多说了，懂 Java 的都该知道这个。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">单块系统的时候这么玩儿 session 没问题，但是你要是分布式系统呢，那么多的服务，session 状态在哪儿维护啊？</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">其实方法很多，但是常见常用的是以下几种：</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">完全不用 session</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">使用 JWT Token 储存用户身份，然后再从数据库或者 cache 中获取其他的信息。这样无论请求分配到哪个服务器都无所谓。</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">tomcat + redis</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">这个其实还挺方便的，就是使用 session 的代码，跟以前一样，还是基于 tomcat 原生的 session 支持即可，然后就是用一个叫做 <code style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; color: #c1788b; padding: 4px 4px 2px 0; letter-spacing: -.3px;">Tomcat RedisSessionManager</code> 的东西，让所有我们部署的 tomcat 都将 session 数据存储到 redis 即可。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 tomcat 的配置文件中配置：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">Valve</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">className</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot;</span> /&gt;</span>

<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">Manager</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">className</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</span>
         <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">host</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;{redis.host}&quot;</span>
         <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">port</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;{redis.port}&quot;</span>
         <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">database</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;{redis.dbnum}&quot;</span>
         <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">maxInactiveInterval</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;60&quot;</span>/&gt;</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">然后指定 redis 的 host 和 port 就 ok 了。</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">Valve</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">className</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&quot;</span> /&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">Manager</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">className</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;com.orangefunction.tomcat.redissessions.RedisSessionManager&quot;</span>
	 <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">sentinelMaster</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;mymaster&quot;</span>
	 <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">sentinels</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;&lt;sentinel1-ip&gt;:26379,&lt;sentinel2-ip&gt;:26379,&lt;sentinel3-ip&gt;:26379&quot;</span>
	 <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">maxInactiveInterval</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;60&quot;</span>/&gt;</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">还可以用上面这种方式基于 redis 哨兵支持的 redis 高可用集群来保存 session 数据，都是 ok 的。</p>
<h3 style="line-height: 160%; box-sizing: content-box; font-weight: 700; font-size: 27px; color: #333;">spring session + redis</h3>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">上面所说的第二种方式会与 tomcat 容器重耦合，如果我要将 web 容器迁移成 jetty，难道还要重新把 jetty 都配置一遍？</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">因为上面那种 tomcat + redis 的方式好用，但是会<strong style="line-height: 160%; box-sizing: content-box; font-weight: 700;">严重依赖于web容器</strong>，不好将代码移植到其他 web 容器上去，尤其是你要是换了技术栈咋整？比如换成了 spring cloud 或者是 spring boot 之类的呢？</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">所以现在比较好的还是基于 Java 一站式解决方案，也就是 spring。人家 spring 基本上承包了大部分我们需要使用的框架，spirng cloud 做微服务，spring boot 做脚手架，所以用 sping session 是一个很好的选择。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 pom.xml 中配置：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
  <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>org.springframework.session<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
  <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>spring-session-data-redis<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
  <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>1.2.1.RELEASE<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
  <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>redis.clients<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">groupId</span>&gt;</span>
  <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>jedis<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">artifactId</span>&gt;</span>
  <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>2.8.1<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">version</span>&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">dependency</span>&gt;</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 spring 配置文件中配置：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bean</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">id</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;redisHttpSessionConfiguration&quot;</span>
     <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">class</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration&quot;</span>&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;maxInactiveIntervalInSeconds&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;600&quot;</span>/&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bean</span>&gt;</span>

<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bean</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">id</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;jedisPoolConfig&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">class</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;redis.clients.jedis.JedisPoolConfig&quot;</span>&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;maxTotal&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;100&quot;</span> /&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;maxIdle&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;10&quot;</span> /&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bean</span>&gt;</span>

<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bean</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">id</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;jedisConnectionFactory&quot;</span>
      <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">class</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;org.springframework.data.redis.connection.jedis.JedisConnectionFactory&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">destroy-method</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;destroy&quot;</span>&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;hostName&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;${redis_hostname}&quot;</span>/&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;port&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;${redis_port}&quot;</span>/&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;password&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;${redis_pwd}&quot;</span> /&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;timeout&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;3000&quot;</span>/&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;usePool&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">value</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;true&quot;</span>/&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">property</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">name</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;poolConfig&quot;</span> <span style="color: #9cdcfe; line-height: 160%; box-sizing: content-box;">ref</span>=<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;jedisPoolConfig&quot;</span>/&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">bean</span>&gt;</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">在 web.xml 中配置：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter</span>&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-name</span>&gt;</span>springSessionRepositoryFilter<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-name</span>&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-class</span>&gt;</span>org.springframework.web.filter.DelegatingFilterProxy<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-class</span>&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter</span>&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-mapping</span>&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-name</span>&gt;</span>springSessionRepositoryFilter<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-name</span>&gt;</span>
    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">url-pattern</span>&gt;</span>/*<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">url-pattern</span>&gt;</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">&lt;/<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">filter-mapping</span>&gt;</span>
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">示例代码：</p>
<pre style="line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; margin: 2px 0 8px; background-color: #f5f7f8;"><code style="display: block; overflow-x: auto; background: #1e1e1e; line-height: 160%; box-sizing: content-box; border: 0; border-radius: 0; letter-spacing: -.3px; padding: 18px; color: #f4f4f4; white-space: pre-wrap;"><span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@RestController</span>
<span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@RequestMapping</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;/test&quot;</span>)
<span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> <span style="color: #b8d7a3; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">class</span> <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">TestController</span> </span>{

    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@RequestMapping</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;/putIntoSession&quot;</span>)
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> String <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">putIntoSession</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(HttpServletRequest request, String username)</span> </span>{
        request.getSession().setAttribute(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;name&quot;</span>,  <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;leo&quot;</span>);
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> <span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;ok&quot;</span>;
    }

    <span style="color: #9b9b9b; line-height: 160%; box-sizing: content-box;">@RequestMapping</span>(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;/getFromSession&quot;</span>)
    <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;"><span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">public</span> String <span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">getFromSession</span><span style="color: #dcdcdc; line-height: 160%; box-sizing: content-box;">(HttpServletRequest request, Model model)</span></span>{
        String name = request.getSession().getAttribute(<span style="color: #d69d85; line-height: 160%; box-sizing: content-box;">&quot;name&quot;</span>);
        <span style="color: #569cd6; line-height: 160%; box-sizing: content-box;">return</span> name;
    }
}
</code></pre>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">上面的代码就是 ok 的，给 sping session 配置基于 redis 来存储 session 数据，然后配置了一个 spring session 的过滤器，这样的话，session 相关操作都会交给 spring session 来管了。接着在代码中，就用原生的 session 操作，就是直接基于 spring sesion 从 redis 中获取数据了。</p>
<p style="line-height: 160%; box-sizing: content-box; margin: 10px 0; color: #333;">实现分布式的会话有很多种方式，我说的只不过是比较常见的几种方式，tomcat + redis 早期比较常用，但是会重耦合到 tomcat 中；近些年，通过 spring session 来实现。</p>
</div><center style="display:none !important;visibility:collapse !important;height:0 !important;white-space:nowrap;width:100%;overflow:hidden">%23%23%20%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%97%B6%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%20session%20%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%0A%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E6%97%B6%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%20session%20%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%EF%BC%9F%0A%0A%23%23%20%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90%0A%E9%9D%A2%E8%AF%95%E5%AE%98%E9%97%AE%E4%BA%86%E4%BD%A0%E4%B8%80%E5%A0%86%20dubbo%20%E6%98%AF%E6%80%8E%E4%B9%88%E7%8E%A9%E5%84%BF%E7%9A%84%EF%BC%8C%E4%BD%A0%E4%BC%9A%E7%8E%A9%E5%84%BF%20dubbo%20%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%8A%8A%E5%8D%95%E5%9D%97%E7%B3%BB%E7%BB%9F%E5%BC%84%E6%88%90%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%84%B6%E5%90%8E%E5%88%86%E5%B8%83%E5%BC%8F%E4%B9%8B%E5%90%8E%E6%8E%A5%E8%B8%B5%E8%80%8C%E6%9D%A5%E7%9A%84%E5%B0%B1%E6%98%AF%E4%B8%80%E5%A0%86%E9%97%AE%E9%A2%98%EF%BC%8C%E6%9C%80%E5%A4%A7%E7%9A%84%E9%97%AE%E9%A2%98%E5%B0%B1%E6%98%AF**%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1**%E3%80%81**%E6%8E%A5%E5%8F%A3%E5%B9%82%E7%AD%89%E6%80%A7**%E3%80%81**%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81**%EF%BC%8C%E8%BF%98%E6%9C%89%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%B0%B1%E6%98%AF**%E5%88%86%E5%B8%83%E5%BC%8F%20session**%E3%80%82%0A%0A%E5%BD%93%E7%84%B6%E4%BA%86%EF%BC%8C%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98%E4%BD%95%E6%AD%A2%E8%BF%99%E4%B9%88%E4%B8%80%E7%82%B9%EF%BC%8C%E9%9D%9E%E5%B8%B8%E4%B9%8B%E5%A4%9A%EF%BC%8C%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%BE%88%E9%AB%98%EF%BC%8C%E8%BF%99%E9%87%8C%E5%8F%AA%E6%98%AF%E8%AF%B4%E4%B8%80%E4%B8%8B%E5%B8%B8%E8%A7%81%E7%9A%84%E5%87%A0%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B9%9F%E6%98%AF%E9%9D%A2%E8%AF%95%E7%9A%84%E6%97%B6%E5%80%99%E5%B8%B8%E9%97%AE%E7%9A%84%E5%87%A0%E4%B8%AA%E3%80%82%0A%0A%23%23%20%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90%0Asession%20%E6%98%AF%E5%95%A5%EF%BC%9F%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9C%89%E4%B8%AA%20cookie%EF%BC%8C%E5%9C%A8%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%86%85%E8%BF%99%E4%B8%AA%20cookie%20%E9%83%BD%E5%AD%98%E5%9C%A8%EF%BC%8C%E7%84%B6%E5%90%8E%E6%AF%8F%E6%AC%A1%E5%8F%91%E8%AF%B7%E6%B1%82%E8%BF%87%E6%9D%A5%E9%83%BD%E5%B8%A6%E4%B8%8A%E4%B8%80%E4%B8%AA%E7%89%B9%E6%AE%8A%E7%9A%84%20%60jsessionid%20cookie%60%EF%BC%8C%E5%B0%B1%E6%A0%B9%E6%8D%AE%E8%BF%99%E4%B8%AA%E4%B8%9C%E8%A5%BF%EF%BC%8C%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%AF%E4%BB%A5%E7%BB%B4%E6%8A%A4%E4%B8%80%E4%B8%AA%E5%AF%B9%E5%BA%94%E7%9A%84%20session%20%E5%9F%9F%EF%BC%8C%E9%87%8C%E9%9D%A2%E5%8F%AF%E4%BB%A5%E6%94%BE%E7%82%B9%E6%95%B0%E6%8D%AE%E3%80%82%0A%0A%E4%B8%80%E8%88%AC%E7%9A%84%E8%AF%9D%E5%8F%AA%E8%A6%81%E4%BD%A0%E6%B2%A1%E5%85%B3%E6%8E%89%E6%B5%8F%E8%A7%88%E5%99%A8%EF%BC%8Ccookie%20%E8%BF%98%E5%9C%A8%EF%BC%8C%E9%82%A3%E4%B9%88%E5%AF%B9%E5%BA%94%E7%9A%84%E9%82%A3%E4%B8%AA%20session%20%E5%B0%B1%E5%9C%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E5%A6%82%E6%9E%9C%20cookie%20%E6%B2%A1%E4%BA%86%EF%BC%8Csession%20%E4%B9%9F%E5%B0%B1%E6%B2%A1%E4%BA%86%E3%80%82%E5%B8%B8%E8%A7%81%E4%BA%8E%E4%BB%80%E4%B9%88%E8%B4%AD%E7%89%A9%E8%BD%A6%E4%B9%8B%E7%B1%BB%E7%9A%84%E4%B8%9C%E8%A5%BF%EF%BC%8C%E8%BF%98%E6%9C%89%E7%99%BB%E5%BD%95%E7%8A%B6%E6%80%81%E4%BF%9D%E5%AD%98%E4%B9%8B%E7%B1%BB%E7%9A%84%E3%80%82%0A%0A%E8%BF%99%E4%B8%AA%E4%B8%8D%E5%A4%9A%E8%AF%B4%E4%BA%86%EF%BC%8C%E6%87%82%20Java%20%E7%9A%84%E9%83%BD%E8%AF%A5%E7%9F%A5%E9%81%93%E8%BF%99%E4%B8%AA%E3%80%82%0A%0A%E5%8D%95%E5%9D%97%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%97%B6%E5%80%99%E8%BF%99%E4%B9%88%E7%8E%A9%E5%84%BF%20session%20%E6%B2%A1%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BD%A0%E8%A6%81%E6%98%AF%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E5%91%A2%EF%BC%8C%E9%82%A3%E4%B9%88%E5%A4%9A%E7%9A%84%E6%9C%8D%E5%8A%A1%EF%BC%8Csession%20%E7%8A%B6%E6%80%81%E5%9C%A8%E5%93%AA%E5%84%BF%E7%BB%B4%E6%8A%A4%E5%95%8A%EF%BC%9F%0A%0A%E5%85%B6%E5%AE%9E%E6%96%B9%E6%B3%95%E5%BE%88%E5%A4%9A%EF%BC%8C%E4%BD%86%E6%98%AF%E5%B8%B8%E8%A7%81%E5%B8%B8%E7%94%A8%E7%9A%84%E6%98%AF%E4%BB%A5%E4%B8%8B%E5%87%A0%E7%A7%8D%EF%BC%9A%0A%0A%23%23%23%20%E5%AE%8C%E5%85%A8%E4%B8%8D%E7%94%A8%20session%0A%E4%BD%BF%E7%94%A8%20JWT%20Token%20%E5%82%A8%E5%AD%98%E7%94%A8%E6%88%B7%E8%BA%AB%E4%BB%BD%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E4%BB%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E6%88%96%E8%80%85%20cache%20%E4%B8%AD%E8%8E%B7%E5%8F%96%E5%85%B6%E4%BB%96%E7%9A%84%E4%BF%A1%E6%81%AF%E3%80%82%E8%BF%99%E6%A0%B7%E6%97%A0%E8%AE%BA%E8%AF%B7%E6%B1%82%E5%88%86%E9%85%8D%E5%88%B0%E5%93%AA%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%BD%E6%97%A0%E6%89%80%E8%B0%93%E3%80%82%0A%0A%23%23%23%20tomcat%20%2B%20redis%0A%E8%BF%99%E4%B8%AA%E5%85%B6%E5%AE%9E%E8%BF%98%E6%8C%BA%E6%96%B9%E4%BE%BF%E7%9A%84%EF%BC%8C%E5%B0%B1%E6%98%AF%E4%BD%BF%E7%94%A8%20session%20%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%8C%E8%B7%9F%E4%BB%A5%E5%89%8D%E4%B8%80%E6%A0%B7%EF%BC%8C%E8%BF%98%E6%98%AF%E5%9F%BA%E4%BA%8E%20tomcat%20%E5%8E%9F%E7%94%9F%E7%9A%84%20session%20%E6%94%AF%E6%8C%81%E5%8D%B3%E5%8F%AF%EF%BC%8C%E7%84%B6%E5%90%8E%E5%B0%B1%E6%98%AF%E7%94%A8%E4%B8%80%E4%B8%AA%E5%8F%AB%E5%81%9A%20%60Tomcat%20%20RedisSessionManager%60%20%E7%9A%84%E4%B8%9C%E8%A5%BF%EF%BC%8C%E8%AE%A9%E6%89%80%E6%9C%89%E6%88%91%E4%BB%AC%E9%83%A8%E7%BD%B2%E7%9A%84%20tomcat%20%E9%83%BD%E5%B0%86%20session%20%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%88%B0%20redis%20%E5%8D%B3%E5%8F%AF%E3%80%82%0A%0A%E5%9C%A8%20tomcat%20%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E9%85%8D%E7%BD%AE%EF%BC%9A%0A%0A%60%60%60xml%0A%3CValve%20className%3D%22com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve%22%20%2F%3E%0A%0A%3CManager%20className%3D%22com.orangefunction.tomcat.redissessions.RedisSessionManager%22%0A%20%20%20%20%20%20%20%20%20host%3D%22%7Bredis.host%7D%22%0A%20%20%20%20%20%20%20%20%20port%3D%22%7Bredis.port%7D%22%0A%20%20%20%20%20%20%20%20%20database%3D%22%7Bredis.dbnum%7D%22%0A%20%20%20%20%20%20%20%20%20maxInactiveInterval%3D%2260%22%2F%3E%0A%60%60%60%20%20%20%20%20%20%20%20%20%0A%0A%E7%84%B6%E5%90%8E%E6%8C%87%E5%AE%9A%20redis%20%E7%9A%84%20host%20%E5%92%8C%20port%20%E5%B0%B1%20ok%20%E4%BA%86%E3%80%82%0A%0A%60%60%60xml%0A%3CValve%20className%3D%22com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve%22%20%2F%3E%0A%3CManager%20className%3D%22com.orangefunction.tomcat.redissessions.RedisSessionManager%22%0A%09%20sentinelMaster%3D%22mymaster%22%0A%09%20sentinels%3D%22%3Csentinel1-ip%3E%3A26379%2C%3Csentinel2-ip%3E%3A26379%2C%3Csentinel3-ip%3E%3A26379%22%0A%09%20maxInactiveInterval%3D%2260%22%2F%3E%0A%60%60%60%0A%0A%E8%BF%98%E5%8F%AF%E4%BB%A5%E7%94%A8%E4%B8%8A%E9%9D%A2%E8%BF%99%E7%A7%8D%E6%96%B9%E5%BC%8F%E5%9F%BA%E4%BA%8E%20redis%20%E5%93%A8%E5%85%B5%E6%94%AF%E6%8C%81%E7%9A%84%20redis%20%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%9D%A5%E4%BF%9D%E5%AD%98%20session%20%E6%95%B0%E6%8D%AE%EF%BC%8C%E9%83%BD%E6%98%AF%20ok%20%E7%9A%84%E3%80%82%0A%0A%23%23%23%20spring%20session%20%2B%20redis%0A%E4%B8%8A%E9%9D%A2%E6%89%80%E8%AF%B4%E7%9A%84%E7%AC%AC%E4%BA%8C%E7%A7%8D%E6%96%B9%E5%BC%8F%E4%BC%9A%E4%B8%8E%20tomcat%20%E5%AE%B9%E5%99%A8%E9%87%8D%E8%80%A6%E5%90%88%EF%BC%8C%E5%A6%82%E6%9E%9C%E6%88%91%E8%A6%81%E5%B0%86%20web%20%E5%AE%B9%E5%99%A8%E8%BF%81%E7%A7%BB%E6%88%90%20jetty%EF%BC%8C%E9%9A%BE%E9%81%93%E8%BF%98%E8%A6%81%E9%87%8D%E6%96%B0%E6%8A%8A%20jetty%20%E9%83%BD%E9%85%8D%E7%BD%AE%E4%B8%80%E9%81%8D%EF%BC%9F%0A%0A%E5%9B%A0%E4%B8%BA%E4%B8%8A%E9%9D%A2%E9%82%A3%E7%A7%8D%20tomcat%20%2B%20redis%20%E7%9A%84%E6%96%B9%E5%BC%8F%E5%A5%BD%E7%94%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BC%9A**%E4%B8%A5%E9%87%8D%E4%BE%9D%E8%B5%96%E4%BA%8Eweb%E5%AE%B9%E5%99%A8**%EF%BC%8C%E4%B8%8D%E5%A5%BD%E5%B0%86%E4%BB%A3%E7%A0%81%E7%A7%BB%E6%A4%8D%E5%88%B0%E5%85%B6%E4%BB%96%20web%20%E5%AE%B9%E5%99%A8%E4%B8%8A%E5%8E%BB%EF%BC%8C%E5%B0%A4%E5%85%B6%E6%98%AF%E4%BD%A0%E8%A6%81%E6%98%AF%E6%8D%A2%E4%BA%86%E6%8A%80%E6%9C%AF%E6%A0%88%E5%92%8B%E6%95%B4%EF%BC%9F%E6%AF%94%E5%A6%82%E6%8D%A2%E6%88%90%E4%BA%86%20spring%20cloud%20%E6%88%96%E8%80%85%E6%98%AF%20spring%20boot%20%E4%B9%8B%E7%B1%BB%E7%9A%84%E5%91%A2%EF%BC%9F%0A%0A%E6%89%80%E4%BB%A5%E7%8E%B0%E5%9C%A8%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84%E8%BF%98%E6%98%AF%E5%9F%BA%E4%BA%8E%20Java%20%E4%B8%80%E7%AB%99%E5%BC%8F%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%20spring%E3%80%82%E4%BA%BA%E5%AE%B6%20spring%20%E5%9F%BA%E6%9C%AC%E4%B8%8A%E6%89%BF%E5%8C%85%E4%BA%86%E5%A4%A7%E9%83%A8%E5%88%86%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8%E7%9A%84%E6%A1%86%E6%9E%B6%EF%BC%8Cspirng%20cloud%20%E5%81%9A%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%8Cspring%20boot%20%E5%81%9A%E8%84%9A%E6%89%8B%E6%9E%B6%EF%BC%8C%E6%89%80%E4%BB%A5%E7%94%A8%20sping%20session%20%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BE%88%E5%A5%BD%E7%9A%84%E9%80%89%E6%8B%A9%E3%80%82%0A%0A%E5%9C%A8%20pom.xml%20%E4%B8%AD%E9%85%8D%E7%BD%AE%EF%BC%9A%0A%60%60%60xml%0A%3Cdependency%3E%0A%20%20%3CgroupId%3Eorg.springframework.session%3C%2FgroupId%3E%0A%20%20%3CartifactId%3Espring-session-data-redis%3C%2FartifactId%3E%0A%20%20%3Cversion%3E1.2.1.RELEASE%3C%2Fversion%3E%0A%3C%2Fdependency%3E%0A%3Cdependency%3E%0A%20%20%3CgroupId%3Eredis.clients%3C%2FgroupId%3E%0A%20%20%3CartifactId%3Ejedis%3C%2FartifactId%3E%0A%20%20%3Cversion%3E2.8.1%3C%2Fversion%3E%0A%3C%2Fdependency%3E%0A%60%60%60%0A%0A%E5%9C%A8%20spring%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E9%85%8D%E7%BD%AE%EF%BC%9A%0A%60%60%60xml%0A%3Cbean%20id%3D%22redisHttpSessionConfiguration%22%0A%20%20%20%20%20class%3D%22org.springframework.session.data.redis.config.annotation.web.http.RedisHttpSessionConfiguration%22%3E%0A%20%20%20%20%3Cproperty%20name%3D%22maxInactiveIntervalInSeconds%22%20value%3D%22600%22%2F%3E%0A%3C%2Fbean%3E%0A%0A%3Cbean%20id%3D%22jedisPoolConfig%22%20class%3D%22redis.clients.jedis.JedisPoolConfig%22%3E%0A%20%20%20%20%3Cproperty%20name%3D%22maxTotal%22%20value%3D%22100%22%20%2F%3E%0A%20%20%20%20%3Cproperty%20name%3D%22maxIdle%22%20value%3D%2210%22%20%2F%3E%0A%3C%2Fbean%3E%0A%0A%3Cbean%20id%3D%22jedisConnectionFactory%22%0A%20%20%20%20%20%20class%3D%22org.springframework.data.redis.connection.jedis.JedisConnectionFactory%22%20destroy-method%3D%22destroy%22%3E%0A%20%20%20%20%3Cproperty%20name%3D%22hostName%22%20value%3D%22%24%7Bredis_hostname%7D%22%2F%3E%0A%20%20%20%20%3Cproperty%20name%3D%22port%22%20value%3D%22%24%7Bredis_port%7D%22%2F%3E%0A%20%20%20%20%3Cproperty%20name%3D%22password%22%20value%3D%22%24%7Bredis_pwd%7D%22%20%2F%3E%0A%20%20%20%20%3Cproperty%20name%3D%22timeout%22%20value%3D%223000%22%2F%3E%0A%20%20%20%20%3Cproperty%20name%3D%22usePool%22%20value%3D%22true%22%2F%3E%0A%20%20%20%20%3Cproperty%20name%3D%22poolConfig%22%20ref%3D%22jedisPoolConfig%22%2F%3E%0A%3C%2Fbean%3E%0A%60%60%60%0A%0A%E5%9C%A8%20web.xml%20%E4%B8%AD%E9%85%8D%E7%BD%AE%EF%BC%9A%0A%60%60%60xml%0A%3Cfilter%3E%0A%20%20%20%20%3Cfilter-name%3EspringSessionRepositoryFilter%3C%2Ffilter-name%3E%0A%20%20%20%20%3Cfilter-class%3Eorg.springframework.web.filter.DelegatingFilterProxy%3C%2Ffilter-class%3E%0A%3C%2Ffilter%3E%0A%3Cfilter-mapping%3E%0A%20%20%20%20%3Cfilter-name%3EspringSessionRepositoryFilter%3C%2Ffilter-name%3E%0A%20%20%20%20%3Curl-pattern%3E%2F*%3C%2Furl-pattern%3E%0A%3C%2Ffilter-mapping%3E%0A%60%60%60%0A%0A%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%EF%BC%9A%0A%60%60%60java%0A%40RestController%0A%40RequestMapping(%22%2Ftest%22)%0Apublic%20class%20TestController%20%7B%0A%0A%20%20%20%20%40RequestMapping(%22%2FputIntoSession%22)%0A%20%20%20%20public%20String%20putIntoSession(HttpServletRequest%20request%2C%20String%20username)%20%7B%0A%20%20%20%20%20%20%20%20request.getSession().setAttribute(%22name%22%2C%20%20%22leo%22)%3B%0A%20%20%20%20%20%20%20%20return%20%22ok%22%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20%40RequestMapping(%22%2FgetFromSession%22)%0A%20%20%20%20public%20String%20getFromSession(HttpServletRequest%20request%2C%20Model%20model)%7B%0A%20%20%20%20%20%20%20%20String%20name%20%3D%20request.getSession().getAttribute(%22name%22)%3B%0A%20%20%20%20%20%20%20%20return%20name%3B%0A%20%20%20%20%7D%0A%7D%0A%60%60%60%0A%0A%0A%E4%B8%8A%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E5%B0%B1%E6%98%AF%20ok%20%E7%9A%84%EF%BC%8C%E7%BB%99%20sping%20session%20%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8E%20redis%20%E6%9D%A5%E5%AD%98%E5%82%A8%20session%20%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%84%B6%E5%90%8E%E9%85%8D%E7%BD%AE%E4%BA%86%E4%B8%80%E4%B8%AA%20spring%20session%20%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E8%BF%99%E6%A0%B7%E7%9A%84%E8%AF%9D%EF%BC%8Csession%20%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C%E9%83%BD%E4%BC%9A%E4%BA%A4%E7%BB%99%20spring%20session%20%E6%9D%A5%E7%AE%A1%E4%BA%86%E3%80%82%E6%8E%A5%E7%9D%80%E5%9C%A8%E4%BB%A3%E7%A0%81%E4%B8%AD%EF%BC%8C%E5%B0%B1%E7%94%A8%E5%8E%9F%E7%94%9F%E7%9A%84%20session%20%E6%93%8D%E4%BD%9C%EF%BC%8C%E5%B0%B1%E6%98%AF%E7%9B%B4%E6%8E%A5%E5%9F%BA%E4%BA%8E%20spring%20sesion%20%E4%BB%8E%20redis%20%E4%B8%AD%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E4%BA%86%E3%80%82%0A%0A%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E7%9A%84%E4%BC%9A%E8%AF%9D%E6%9C%89%E5%BE%88%E5%A4%9A%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%8C%E6%88%91%E8%AF%B4%E7%9A%84%E5%8F%AA%E4%B8%8D%E8%BF%87%E6%98%AF%E6%AF%94%E8%BE%83%E5%B8%B8%E8%A7%81%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%8Ctomcat%20%2B%20redis%20%E6%97%A9%E6%9C%9F%E6%AF%94%E8%BE%83%E5%B8%B8%E7%94%A8%EF%BC%8C%E4%BD%86%E6%98%AF%E4%BC%9A%E9%87%8D%E8%80%A6%E5%90%88%E5%88%B0%20tomcat%20%E4%B8%AD%EF%BC%9B%E8%BF%91%E4%BA%9B%E5%B9%B4%EF%BC%8C%E9%80%9A%E8%BF%87%20spring%20session%20%E6%9D%A5%E5%AE%9E%E7%8E%B0%E3%80%82</center></span>
</div></body></html> 